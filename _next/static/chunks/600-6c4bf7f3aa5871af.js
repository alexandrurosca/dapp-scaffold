(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{5408:function(e,t,n){"use strict";n.d(t,{W:function(){return M},u:function(){return N}});var r,i=n(4389),s=n(7294),a=n(4306),l=n(4718),o={i8:"0.2.0"},c=n(29),u=n(7794),d=n.n(u),m=n(4671),f=n(5065),p=(0,m.Z)(function(e,t){var n;return{balance:0,getUserSOLBalance:(n=(0,c.Z)(d().mark(function t(n,r){var i;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,t.prev=1,t.next=4,r.getBalance(n,"confirmed");case 4:i=t.sent/f.LAMPORTS_PER_SOL,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.log("error getting balance: ",t.t0);case 11:e(function(e){e.balance=i,console.log("balance updated, ",i)});case 12:case"end":return t.stop()}},t,null,[[1,8]])})),function(e,t){return n.apply(this,arguments)})}}),g=n(9499),v=n(6835),h=n(4758),b=n(8467),x=n(7043),y=JSON.parse('{"version":"0.1.0","name":"anchor_program","instructions":[{"name":"initialize","accounts":[{"name":"tokenHolder","isMut":true,"isSigner":false},{"name":"user","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"tokenProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"stake","accounts":[{"name":"escrow","isMut":true,"isSigner":false},{"name":"user","isMut":true,"isSigner":true},{"name":"mint","isMut":true,"isSigner":false},{"name":"tokenAccount","isMut":true,"isSigner":false},{"name":"receiverAccount","isMut":true,"isSigner":false},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"tokenProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"unstake","accounts":[{"name":"escrow","isMut":true,"isSigner":false},{"name":"user","isMut":true,"isSigner":true},{"name":"mint","isMut":true,"isSigner":false},{"name":"tokenAccount","isMut":true,"isSigner":false},{"name":"receiverAccount","isMut":true,"isSigner":false},{"name":"rewardVaultAcc","isMut":true,"isSigner":false},{"name":"rewardUserAcc","isMut":true,"isSigner":false},{"name":"authority","isMut":true,"isSigner":false},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"tokenProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"claim","accounts":[{"name":"escrow","isMut":true,"isSigner":false},{"name":"user","isMut":true,"isSigner":true},{"name":"mint","isMut":true,"isSigner":false},{"name":"rewardVaultAcc","isMut":true,"isSigner":false},{"name":"rewardUserAcc","isMut":true,"isSigner":false},{"name":"authority","isMut":true,"isSigner":false},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"tokenProgram","isMut":false,"isSigner":false}],"args":[]}],"accounts":[{"name":"EscrowStake","type":{"kind":"struct","fields":[{"name":"lastClaimedAt","type":"i64"},{"name":"stakedAt","type":"i64"},{"name":"totalClaimed","type":"u64"},{"name":"mint","type":"publicKey"},{"name":"owner","type":"publicKey"}]}},{"name":"TokenHolderAcc","type":{"kind":"struct","fields":[{"name":"initialized","type":"bool"}]}}],"errors":[{"code":6000,"name":"NotOwner","msg":"Cannot withdraw if not owner"}],"metadata":{"address":"ByKpVE7PmU4oQwoJLfMcD9CqFkDXRhsZkq3X4xfNUQ3P"}}'),w=n(5893);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var S=JSON.parse(JSON.stringify(y)),j=new f.PublicKey(y.metadata.address),P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return!e||e.length<=30?""===e?"-":e:e.substring(0,t)+"..."+e.substring(e.length-t,e.length)},K=(r=(0,c.Z)(d().mark(function e(t,n){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.rV.PublicKey.findProgramAddress([n.toBuffer(),b.H_.toBuffer(),t.toBuffer()],new f.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)}),A=function(){var e,t,n,r,i,o=(0,a.O)(),u=(0,l.R)().connection,m=(0,s.useState)([]),p=m[0],y=m[1],A=(0,s.useState)([]),N=A[0],M=A[1];(0,s.useEffect)(function(){I()},[]);var O=(e=(0,c.Z)(d().mark(function e(t){var n,r,i,s;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://corsproxy.io/?"+encodeURIComponent("https://api-devnet.magiceden.dev/v2/wallets/".concat(t,"/tokens?offset=0&limit=100&listStatus=both")),e.next=3,null===(n=fetch(r))||void 0===n?void 0:n.then(function(e){return null==e?void 0:e.json()});case 3:(i=e.sent)&&M(null==i?void 0:null===(s=i.filter(function(e){var t;return null==e?void 0:null===(t=e.image)||void 0===t?void 0:t.startsWith("http")}))||void 0===s?void 0:s.filter(function(e){return!(null!=p&&p.find(function(t){return t.mint===e.mintAddress}))}));case 5:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)});(0,s.useEffect)(function(){if(o.publicKey){var e;O(null===(e=o.publicKey)||void 0===e?void 0:e.toBase58())}},[o.publicKey,p]);var C=function(){return new h.Y7(u,o,h.Y7.defaultOptions())},T=(t=(0,c.Z)(d().mark(function e(t){var n,r,i,s,a,l,c,m,p,g,y,w,k,P,A,N;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.PublicKey(t),e.prev=1,s=C(),a=new h.$r(S,j,s),e.next=6,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("escrow"),null===(r=s.wallet.publicKey)||void 0===r?void 0:r.toBuffer(),null==n?void 0:n.toBuffer()],a.programId);case 6:return l=e.sent,c=(0,v.Z)(l,1)[0],e.next=11,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("tokenauthority")],a.programId);case 11:return m=e.sent,p=(0,v.Z)(m,1)[0],e.next=16,K(n,s.wallet.publicKey);case 16:return g=e.sent[0],e.next=19,K(n,p);case 19:return y=e.sent[0],e.next=22,u.getAccountInfo(y);case 22:if(w=e.sent,k=[],w){e.next=29;break}return e.next=27,(0,x.E)(s.wallet.publicKey,y,p,n);case 27:P=e.sent,k.push(P);case 29:return e.next=31,a.methods.stake().accountsStrict({escrow:c,user:s.wallet.publicKey,mint:n,tokenAccount:g,receiverAccount:y,systemProgram:h.rV.SystemProgram.programId,tokenProgram:b.H_}).signers([]).instruction();case 31:return A=e.sent,k.push(A),(N=new f.Transaction).add.apply(N,k),e.next=37,a.provider.connection.getLatestBlockhash("finalized");case 37:if(e.t1=i=e.sent,e.t0=null===e.t1,e.t0){e.next=41;break}e.t0=void 0===i;case 41:if(!e.t0){e.next=45;break}e.t2=void 0,e.next=46;break;case 45:e.t2=i.blockhash;case 46:return N.recentBlockhash=e.t2,N.feePayer=new f.PublicKey(s.wallet.publicKey),e.next=50,o.sendTransaction(N,s.connection,{skipPreflight:!0});case 50:console.log({tx:e.sent}),e.next=57;break;case 54:e.prev=54,e.t3=e.catch(1),console.log(e.t3);case 57:case"end":return e.stop()}},e,null,[[1,54]])})),function(e){return t.apply(this,arguments)}),D=(n=(0,c.Z)(d().mark(function e(t){var n,r,i,s,a,l,c,m,p,g,y,w,k,P,A,N,M,O,T,D,B,I;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.PublicKey(t),e.prev=1,s=C(),a=new h.$r(S,j,s),l=new f.PublicKey("DoRqnUJcuXUKmurDF8t9kRYQLTJ4gRbjXFqVtmVg9vDi"),e.next=7,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("escrow"),null===(r=s.wallet.publicKey)||void 0===r?void 0:r.toBuffer(),null==n?void 0:n.toBuffer()],a.programId);case 7:return c=e.sent,p=(m=(0,v.Z)(c,2))[0],m[1],e.next=13,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("tokenauthority")],a.programId);case 13:return g=e.sent,w=(y=(0,v.Z)(g,2))[0],y[1],e.next=19,K(n,s.wallet.publicKey);case 19:return k=e.sent[0],e.next=22,K(n,w);case 22:return P=e.sent[0],e.next=25,K(l,s.wallet.publicKey);case 25:return A=e.sent[0],e.next=28,K(l,w);case 28:return N=e.sent[0],e.next=31,u.getAccountInfo(k);case 31:if(M=e.sent,O=[],M){e.next=38;break}return e.next=36,(0,x.E)(s.wallet.publicKey,k,a.programId,n);case 36:T=e.sent,O.push(T);case 38:return e.next=40,u.getAccountInfo(A);case 40:if(e.sent){e.next=46;break}return e.next=44,(0,x.E)(s.wallet.publicKey,A,s.wallet.publicKey,l);case 44:D=e.sent,O.push(D);case 46:return e.next=48,a.methods.unstake().accountsStrict({escrow:p,user:s.wallet.publicKey,mint:n,tokenAccount:P,receiverAccount:k,rewardVaultAcc:N,rewardUserAcc:A,authority:w,systemProgram:h.rV.SystemProgram.programId,tokenProgram:b.H_,associatedTokenProgram:b._u}).signers([]).instruction();case 48:return B=e.sent,O.push(B),(I=new f.Transaction).add.apply(I,O),e.next=54,a.provider.connection.getLatestBlockhash("finalized");case 54:if(e.t1=i=e.sent,e.t0=null===e.t1,e.t0){e.next=58;break}e.t0=void 0===i;case 58:if(!e.t0){e.next=62;break}e.t2=void 0,e.next=63;break;case 62:e.t2=i.blockhash;case 63:return I.recentBlockhash=e.t2,I.feePayer=new f.PublicKey(s.wallet.publicKey),e.next=67,o.sendTransaction(I,s.connection,{skipPreflight:!0});case 67:console.log({tx:e.sent}),e.next=74;break;case 71:e.prev=71,e.t3=e.catch(1),console.log(e.t3);case 74:case"end":return e.stop()}},e,null,[[1,71]])})),function(e){return n.apply(this,arguments)}),B=(r=(0,c.Z)(d().mark(function e(t){var n,r,i,s,a,l,c,m,p,g,y,w,k,P,A,N,M,O;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.PublicKey(t),e.prev=1,s=C(),a=new h.$r(S,j,s),l=new f.PublicKey("DoRqnUJcuXUKmurDF8t9kRYQLTJ4gRbjXFqVtmVg9vDi"),e.next=7,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("escrow"),null===(r=s.wallet.publicKey)||void 0===r?void 0:r.toBuffer(),null==n?void 0:n.toBuffer()],a.programId);case 7:return c=e.sent,p=(m=(0,v.Z)(c,2))[0],m[1],e.next=13,f.PublicKey.findProgramAddressSync([h.P6.bytes.utf8.encode("tokenauthority")],a.programId);case 13:return g=e.sent,w=(y=(0,v.Z)(g,2))[0],y[1],e.next=19,K(n,s.wallet.publicKey);case 19:return e.sent[0],e.next=22,K(n,w);case 22:return e.sent[0],e.next=25,K(l,s.wallet.publicKey);case 25:return k=e.sent[0],e.next=28,K(l,w);case 28:return P=e.sent[0],A=[],e.next=32,u.getAccountInfo(k);case 32:if(e.sent){e.next=38;break}return e.next=36,(0,x.E)(s.wallet.publicKey,k,s.wallet.publicKey,l);case 36:N=e.sent,A.push(N);case 38:return e.next=40,a.methods.claim().accountsStrict({escrow:p,user:s.wallet.publicKey,mint:n,rewardVaultAcc:P,rewardUserAcc:k,authority:w,systemProgram:h.rV.SystemProgram.programId,tokenProgram:b.H_,associatedTokenProgram:b._u}).signers([]).instruction();case 40:return M=e.sent,A.push(M),(O=new f.Transaction).add.apply(O,A),e.next=46,a.provider.connection.getLatestBlockhash("finalized");case 46:if(e.t1=i=e.sent,e.t0=null===e.t1,e.t0){e.next=50;break}e.t0=void 0===i;case 50:if(!e.t0){e.next=54;break}e.t2=void 0,e.next=55;break;case 54:e.t2=i.blockhash;case 55:return O.recentBlockhash=e.t2,O.feePayer=new f.PublicKey(s.wallet.publicKey),e.next=59,o.sendTransaction(O,s.connection,{skipPreflight:!0});case 59:console.log({tx:e.sent}),e.next=66;break;case 63:e.prev=63,e.t3=e.catch(1),console.log(e.t3);case 66:case"end":return e.stop()}},e,null,[[1,63]])})),function(e){return r.apply(this,arguments)}),I=(i=(0,c.Z)(d().mark(function e(){var t,n,r,i,s,a,l,o,c,m,f,p,v,b,x;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=C(),n=new h.$r(S,j,t),e.next=5,u.getProgramAccounts(j);case 5:r=e.sent,i=[],s=0;case 8:if(!(s<r.length)){e.next=32;break}return e.prev=9,e.next=12,n.account.escrowStake.fetch(r[s].pubkey);case 12:return f=e.sent,p={},e.prev=14,x="https://corsproxy.io/?"+encodeURIComponent("https://api-devnet.magiceden.dev/v2/tokens/".concat(null==f?void 0:null===(v=f.mint)||void 0===v?void 0:v.toString())),e.next=18,null===(b=fetch(x))||void 0===b?void 0:b.then(function(e){return null==e?void 0:e.json()});case 18:p=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){(0,g.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e.sent),e.next=24;break;case 22:e.prev=22,e.t0=e.catch(14);case 24:i.push({lastClaimedAt:null==f?void 0:null===(a=f.lastClaimedAt)||void 0===a?void 0:a.toString(),stakedAt:null==f?void 0:null===(l=f.stakedAt)||void 0===l?void 0:l.toString(),totalClaimed:null==f?void 0:null===(o=f.totalClaimed)||void 0===o?void 0:o.toString(),mint:null==f?void 0:null===(c=f.mint)||void 0===c?void 0:c.toString(),owner:null==f?void 0:null===(m=f.owner)||void 0===m?void 0:m.toString(),pubkey:r[s].pubkey,mintData:p}),e.next=29;break;case 27:e.prev=27,e.t1=e.catch(9);case 29:s++,e.next=8;break;case 32:y([].concat(i)),e.next=38;break;case 35:e.prev=35,e.t2=e.catch(0),console.log(e.t2);case 38:case"end":return e.stop()}},e,null,[[0,35],[9,27],[14,22]])})),function(){return i.apply(this,arguments)});return null!=o&&o.publicKey?(0,w.jsxs)(w.Fragment,{children:["My Nfts:",(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:null==N?void 0:N.map(function(e,t){var n;return(0,w.jsxs)("div",{style:{margin:20,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",flex:1},children:(0,w.jsx)("img",{src:e.image,height:100,width:100,style:{alignSelf:"center"}})}),(0,w.jsx)("div",{children:e.name}),(0,w.jsx)("div",{children:P(null==e?void 0:null===(n=e.mintAddress)||void 0===n?void 0:n.toString())}),(0,w.jsxs)("button",{className:"group w-30 m-2 btn animate-pulse bg-gradient-to-br from-indigo-500 to-fuchsia-500 hover:from-white hover:to-purple-300 text-black",onClick:function(){return T(null==e?void 0:e.mintAddress)},disabled:!(null!=o&&o.publicKey),children:[(0,w.jsx)("div",{className:"hidden group-disabled:block",children:"Wallet not connected"}),(0,w.jsx)("span",{className:"block group-disabled:hidden",children:"Stake nft"})]})]},e.mintAddress+t)})}),(0,w.jsx)("div",{className:"flex flex-row justify-center",children:(0,w.jsxs)("div",{className:"relative group items-center",children:[(0,w.jsx)("div",{className:"m-1 absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-fuchsia-500  rounded-lg blur opacity-20 group-hover:opacity-100 transition duration-1000 group-hover:duration-200 animate-tilt"}),(0,w.jsxs)("button",{className:"group w-60 m-2 btn animate-pulse bg-gradient-to-br from-indigo-500 to-fuchsia-500 hover:from-white hover:to-purple-300 text-black",onClick:I,disabled:!(null!=o&&o.publicKey),children:[(0,w.jsx)("div",{className:"hidden group-disabled:block",children:"Wallet not connected"}),(0,w.jsx)("span",{className:"block group-disabled:hidden",children:"fetch staked NFTs"})]})]})}),(0,w.jsxs)("div",{className:"flex columns justify-center",style:{flexWrap:"wrap"},children:[!(null!=p&&p.length)&&(0,w.jsx)("div",{children:"Loading staked NFTs..."}),p.map(function(e,t){var n,r,i,s,a,l,c,u;return(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",flex:1},children:(0,w.jsx)("img",{src:e.mintData.image,height:100,width:100})}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignContent:"center",alignItems:"center"},children:[(0,w.jsxs)("div",{children:["staked At: ",new Date((null==e?void 0:e.stakedAt)*1e3).toLocaleString()]}),(0,w.jsxs)("div",{children:["last ClaimedAt: ",(null==e?void 0:e.lastClaimedAt)!="0"?new Date((null==e?void 0:e.lastClaimedAt)*1e3).toLocaleString():"-"]}),(0,w.jsxs)("div",{children:["total Claimed: ",(null==e?void 0:e.totalClaimed)/1e9," COINS"]}),(0,w.jsxs)("div",{children:["mint: ",P(null==e?void 0:null===(n=e.mint)||void 0===n?void 0:n.toString())]}),(0,w.jsxs)("div",{children:["owner: ",P(null==e?void 0:null===(r=e.owner)||void 0===r?void 0:r.toString())]}),(0,w.jsxs)("div",{children:["name: ",P(null==e?void 0:null===(i=e.mintData)||void 0===i?void 0:null===(s=i.name)||void 0===s?void 0:s.toString())]})]}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignContent:"center",alignItems:"center",margin:20},children:[(0,w.jsxs)("button",{className:"group w-60 m-2 btn animate-pulse bg-gradient-to-br from-indigo-500 to-fuchsia-500 hover:from-white hover:to-purple-300 text-black",onClick:function(){var t;return B(null==e?void 0:null===(t=e.mint)||void 0===t?void 0:t.toString())},disabled:(null==o?void 0:null===(a=o.publicKey)||void 0===a?void 0:a.toBase58())!==(null===(l=e.owner)||void 0===l?void 0:l.toString()),children:[(0,w.jsx)("div",{className:"hidden group-disabled:block",children:"NOT ALLOWED TO CLAIM"}),(0,w.jsx)("span",{className:"block group-disabled:hidden",children:"Claim rewards (~ "+((null==e?void 0:e.lastClaimedAt)!="0"?Math.round(new Date().getTime()/1e3-(null==e?void 0:e.lastClaimedAt)):Math.round(new Date().getTime()/1e3-(null==e?void 0:e.stakedAt)))+")"})]}),(0,w.jsxs)("button",{className:"group w-60 m-2 btn animate-pulse bg-gradient-to-br from-indigo-500 to-fuchsia-500 hover:from-white hover:to-purple-300 text-black",onClick:function(){return D(e.mint)},disabled:(null==o?void 0:null===(c=o.publicKey)||void 0===c?void 0:c.toBase58())!==(null===(u=e.owner)||void 0===u?void 0:u.toString()),children:[(0,w.jsx)("div",{className:"hidden group-disabled:block",children:"NOT ALLOWED TO UNSTAKE"}),(0,w.jsx)("span",{className:"block group-disabled:hidden",children:"UNSTAKE NFT"})]})]})]},t+"asd")})]})]}):(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("div",{className:"flex flex-row justify-center",children:[(0,w.jsx)("div",{className:"relative group items-center"}),"Wallet not connected, please connect"]})})},N=function(e){(0,i.Z)(e);var t=(0,a.O)(),n=(0,l.R)().connection;p(function(e){return e.balance});var r=p().getUserSOLBalance;return(0,s.useEffect)(function(){t.publicKey&&(console.log(t.publicKey.toBase58()),r(t.publicKey,n))},[t.publicKey,n,r]),(0,w.jsx)("div",{className:"md:hero mx-auto p-4",children:(0,w.jsxs)("div",{className:"md:hero-content flex flex-col",children:[(0,w.jsxs)("div",{className:"mt-6",children:[(0,w.jsxs)("div",{className:"text-sm font-normal align-bottom text-right text-slate-600 mt-4",children:["v",o.i8]}),(0,w.jsx)("h1",{className:"text-center text-5xl md:pl-12 font-bold text-transparent bg-clip-text bg-gradient-to-br from-indigo-500 to-fuchsia-500 mb-4",children:"NFTs Staking"})]}),(0,w.jsx)(A,{})]})})},M=function(e){return(0,i.Z)(e),(0,w.jsx)("div",{className:"md:hero mx-auto p-4",children:(0,w.jsxs)("div",{className:"md:hero-content flex flex-col",children:[(0,w.jsx)("h1",{className:"text-center text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-br from-indigo-500 to-fuchsia-500 mt-10 mb-8",children:"NFTs staking"}),(0,w.jsx)("div",{className:"text-center",children:(0,w.jsx)(A,{})})]})})}},5395:function(){},9806:function(){}}]);